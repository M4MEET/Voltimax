{% sw_extends "@Storefront/storefront/component/buy-widget/buy-widget.html.twig" %}

{% block buy_widget %}
    {% block page_product_detail_headline_inner %}
        {% block page_product_detail_name_container %}
            <div class="col product-detail-name-container mt-3 mb-0">
                {% block page_product_detail_name %}
                    <h2 class="product-detail-name"
                        itemprop="name">
                        {{ page.product.translated.name }}
                    </h2>
                {% endblock %}
            </div>
        {% endblock %}
    {% endblock %}

    {% block buy_widget_buy_container %}
        <div itemprop="offers"
             itemscope
             itemtype="{% if product.calculatedPrices|length > 1 %}https://schema.org/AggregateOffer{% else %}https://schema.org/Offer{% endif %}">
            {% block buy_widget_data %}
                {% block buy_widget_data_rich_snippet_url %}
                    <meta itemprop="url"
                          content="{{ seoUrl('frontend.detail.page', { productId: product.id }) }}">
                {% endblock %}

                {% block buy_widget_data_rich_snippet_price_range %}
                    {% if product.calculatedPrices|length > 1 %}
                        {% set lowestPrice = false %}
                        {% set highestPrice = false %}

                        {% for price in product.calculatedPrices %}
                            {% if not lowestPrice or price.unitPrice < lowestPrice %}
                                {% set lowestPrice = price.unitPrice %}
                            {% endif %}
                            {% if not highestPrice or price.unitPrice > highestPrice %}
                                {% set highestPrice = price.unitPrice %}
                            {% endif %}
                        {% endfor %}

                        <meta itemprop="lowPrice" content="{{ lowestPrice }}">
                        <meta itemprop="highPrice" content="{{ highestPrice }}">
                        <meta itemprop="offerCount" content="{{ product.calculatedPrices|length }}">
                    {% endif %}
                {% endblock %}

                {% block buy_widget_data_rich_snippet_price_currency %}
                    <meta itemprop="priceCurrency"
                          content="{{ context.currency.translated.shortName }}">
                {% endblock %}

                <div class="row align-items-center justify-content-between">
                    {% block buy_widget_price %}
                        <div class="col-12 col-md-4">
                            {% sw_include '@Storefront/storefront/component/buy-widget/buy-widget-price.html.twig' %}
                        </div>
                    {% endblock %}

                    {% block page_product_detail_manufacturer %}
                        {% if page.product.manufacturer %}
                            <div class="col-12 col-md-auto text-md-end mt-3 mt-md-0">
                                {% block page_product_detail_manufacturer_inner %}
                                    {% block page_product_detail_manufacturer_link %}
                                        <a href="{{ page.product.manufacturer.link }}"
                                           class="product-detail-manufacturer-link"
                                           rel="noreferrer noopener"
                                           target="_blank"
                                           title="{{ page.product.manufacturer.translated.name }}">
                                            {% if page.product.manufacturer.media %}
                                                {% block page_product_detail_manufacturer_logo %}
                                                    <img src="{{ page.product.manufacturer.media|sw_encode_media_url }}"
                                                         class="product-detail-manufacturer-logo"
                                                         alt="{{ page.product.manufacturer.translated.name }}"/>
                                                {% endblock %}
                                            {% else %}
                                                {% block page_product_detail_manufacturer_text %}
                                                    {{ page.product.manufacturer.translated.name }}
                                                {% endblock %}
                                            {% endif %}
                                        </a>
                                    {% endblock %}
                                {% endblock %}
                            </div>
                        {% endif %}
                    {% endblock %}
                </div>

                {% block buy_widget_tax %}
                    <div class="product-detail-tax-container">
                        {% if context.taxState == "gross" %}
                            {% set taxText = "VoltimaxTheme.detail.product.grossTaxInformation"|trans({'%product.taxRate%':page.product.tax.taxRate}) |sw_sanitize %}
                        {% else %}
                            {% set taxText = "VoltimaxTheme.detail.product.netTaxInformation"|trans({'%product.taxRate%':page.product.tax.taxRate}) |sw_sanitize %}
                        {% endif %}

                        <p class="product-detail-tax mt-3">
                            {% block buy_widget_tax_link %}
                                {% set cmsPath = path('frontend.cms.page', { id: config('core.basicInformation.shippingPaymentInfoPage') }) %}

                                <a class="product-detail-tax-link text-primary text-decoration-underline font-weight-bold fs-5"
                                   href="{{ cmsPath }}"
                                   title="{{ taxText }}"
                                   data-ajax-modal="true"
                                   data-url="{{ cmsPath }}">
                                    {{ taxText }}
                                </a>
                            {% endblock %}
                        </p>
                    </div>

                    {% set taxInfoAlert = config('VoltimaxTheme.config.taxInfoAlert') %}
                    {% set configProductTaxId = page.extensions.configProductTaxId.getTaxEntity() %}
                    {% set productTaxId = page.product.taxId %}
                    {% set showBanner = taxInfoAlert and productTaxId == configProductTaxId %}

                    {% if showBanner %}
                        {% block voltimax_custom_banner_detail_info_box %}
                            {% set taxInfoTextDetail = "VoltimaxTheme.config.taxInfoTextDetail" | trans | sw_sanitize %}
                            {% sw_include '@Storefront/storefront/utilities/alert.html.twig' with {
                                type: 'info',
                                content: taxInfoTextDetail,
                                icon: 'info'
                            } %}
                        {% endblock %}
                    {% endif %}
                {% endblock %}

                {% block buy_widget_reviews %}
                    {% if product.ratingAverage > 0 and totalReviews > 0 and config('core.listing.showReview') %}

                        {% if remoteClickOptions is not defined %}
                            {% set remoteClickOptions = {
                                selector: '#review-tab-' ~ product.id,
                                scrollToElement: true,
                                excludedViewports: ['XS']
                            } %}
                        {% endif %}

                        {% if reviewTabHref is not defined %}
                            {% set reviewTabHref = '#review-tab-' ~ product.id ~ '-pane' %}
                        {% endif %}

                        {% set reviewTabContent = 'review-tab-' ~ product.id ~ '-pane' %}

                        <div class="product-detail-reviews">

                            {% sw_include '@Storefront/storefront/component/review/rating.html.twig' with {
                                points: product.ratingAverage,
                                style: 'text-primary'
                            } %}
                            <a
                                    class="product-detail-reviews-link"
                                    data-off-canvas-tabs="true"
                                    data-remote-click="true"
                                    data-remote-click-options="{{ remoteClickOptions|json_encode }}"
                                    href="{{ reviewTabHref }}"
                                    aria-controls="{{ reviewTabContent }}"
                            >
                                {{ totalReviews }}
                                {{ 'detail.reviewLinkText'|trans({'%count%': totalReviews})|sw_sanitize }}
                            </a>
                        </div>
                    {% endif %}
                {% endblock %}

                {% block buy_widget_delivery_informations %}
                    <div class="product-detail-delivery-information">
                        {% sw_include '@Storefront/storefront/component/delivery-information.html.twig' %}
                    </div>
                {% endblock %}
            {% endblock %}

            {% block buy_widget_configurator_include %}
                {% if product.parentId and configuratorSettings|length > 0 %}
                    <div class="product-detail-configurator-container">
                        {% sw_include '@Storefront/storefront/component/buy-widget/configurator.html.twig' %}
                    </div>
                {% endif %}
            {% endblock %}

            {% block buy_widget_buy_form %}
                {% if product.active %}
                    <div class="product-detail-form-container">
                        {% sw_include '@Storefront/storefront/component/buy-widget/buy-widget-form.html.twig' %}
                    </div>
                {% endif %}
            {% endblock %}
        </div>
    {% endblock %}



{% endblock %}