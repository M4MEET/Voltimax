{% sw_extends "@Storefront/storefront/block/cms-block-gallery-buybox.html.twig" %}

{% block block_gallery_buybox %}
    {# Add tax banner before gallery and buybox on product pages #}
    {% if controllerName == 'Product' and controllerAction == 'index' and page.product is defined %}
        {% set taxInfoAlert = config('VoltimaxTheme.config.taxInfoAlert') %}
        {% set configProductTaxId = page.extensions.configProductTaxId.getTaxEntity() %}
        {% set taxInfoText = "VoltimaxTheme.config.taxInfoText" | trans %}
        {% set productTaxId = page.product.taxId %}
        {% set cmsPageId = config('VoltimaxTheme.config.taxInfoCmsPage') %}
        {% set cmsPageUrl = path('frontend.cms.page', { id: cmsPageId }) %}
        
        {% set showBanner = taxInfoAlert and productTaxId == configProductTaxId %}
        {% if showBanner %}
            <div class="col-12 mb-3">
                <div class="row justify-content-center">
                    <div class="col-12 col-md-10 col-lg-8">
                        <div class="alert alert-primary text-center d-flex align-items-center justify-content-center" role="alert" style="gap: 10px;">
                            <strong class="text-primary mb-0 d-inline-flex align-items-center">
                                <a href="{{ cmsPageUrl }}"
                                   title="{{ taxInfoText }}"
                                   data-ajax-modal="true"
                                   data-url="{{ cmsPageUrl }}"
                                   class="text-dark">
                                    {{ taxInfoText | sw_sanitize }}
                                </a>
                            </strong>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% endif %}

    {% block block_gallery_buybox_column_left %}
        {% set element = block.slots.getSlot('left') %}
        {% set config = element.fieldConfig.elements %}

        <div class="col-lg-7 product-detail-media" data-cms-element-id="{{ element.id }}">
            {% block block_gallery_buybox_column_left_inner %}
                {% sw_include '@Storefront/storefront/element/cms-element-' ~ element.type ~ '.html.twig' ignore missing
                    with {
                    isProduct: config.sliderItems.value == 'product.media' and config.sliderItems.source == 'mapped',
                    startIndexThumbnails: 1,
                    startIndexSlider: 1
                } %}
            {% endblock %}
        </div>
    {% endblock %}

    {% block block_gallery_buybox_column_right %}
        {% set element = block.slots.getSlot('right') %}

        <div class="col-lg-5 product-detail-buy bg-secondary border rounded" data-cms-element-id="{{ element.id }}">
            {% block block_gallery_buybox_column_right_inner %}
                {% sw_include '@Storefront/storefront/element/cms-element-' ~ element.type ~ '.html.twig' ignore missing %}
            {% endblock %}
        </div>
    {% endblock %}
{% endblock %}